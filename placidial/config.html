<!DOCTYPE html>
<html>
    <meta charset="UTF-8">
    <head>
    <title>Placidial Configuration</title>
    <link rel='stylesheet' type='text/css' href='css/slate.min.css'>
    <script src='js/slate.min.js'></script>
    </head>

    <body>
        <div class='item-container'>
            <h1 class='title'>Placidial Configuration</h1>
        </div>
        <div class='item-container'>
            <!-- <div class='item-container-header'>Second Hand</div> -->
            <div class='item-container-content'>
                <label class="item">
                    Background Color
                    <input id="bgcol" type="text" class="item-color item-color-normal">
                </label>
            </div>
        </div>
        <div class='item-container'>
            <!-- <div class='item-container-header'>Second Hand</div> -->
            <div class='item-container-content'>
                <label class='item'>
                    Show Day
                    <input id='showday' type='checkbox' class='item-toggle'>
                </label>
            </div>
            <div class='item-container-footer'>
                Show day of month and marker for day of week.
            </div>
        </div>
        <div class='item-container'>
            <div class='item-container-content'>
                <label class='item'>
                    Show Second Hand
                    <input id='showsec' type='checkbox' class='item-toggle'>
                </label>
            </div>
            <div class='item-container-footer'>
                Show hand for seconds.
            </div>
        </div>
        <div class='item-container'>
            <div class='item-container-content'>
                <label class='item'>
                    Outline
                    <input id='outline' type='checkbox' class='item-toggle'>
                </label>
            </div>
            <div class='item-container-footer'>
                Add a thin outline when drawing clock hands.
            </div>
        </div>
        <div class='item-container'>
            <div class='button-container'>
                <input id='submitButton' type='button' class='item-button' value='SAVE'>
            </div>
        </div>

    </body>
    <script>
        function colorFromString(str) {
            var col = parseInt(str);
            var col8 = ((col & 0xC00000) >> (22 - 4)) |
                       ((col & 0x00C000) >> (14 - 2)) |
                       ((col & 0x0000C0) >> 6);
            return col8;
        }

        function colorToString(c) {
            var col8 = parseInt(c);
            var col = (((col8 & 0x30) * 0x55) << 12) |
                      (((col8 & 0x0C) * 0x55) << 6) |
                      ((col8 & 0x03) * 0x55);
            var str = "0x" + ("000000" + col.toString(16)).slice(-6);
            console.log(str);
            return str;
        }

        function getConfigData() {
            var configData = {
                'showsec' : +document.getElementById('showsec').checked,
                'showday' : +document.getElementById('showday').checked,
                'outline' : +document.getElementById('outline').checked,
                'bgcol' : colorFromString(document.getElementById('bgcol').value),
            };

            console.log('Got: ' + JSON.stringify(configData));
            return configData;
        }

        function getQueryParam(variable, defaultValue)
        {
            var query = location.search.substring(1);
            var vars = query.split('&');
            for (var i = 0; i < vars.length; i++)
            {
                var pair = vars[i].split('=');
                if (pair[0] === variable) {
                    return decodeURIComponent(pair[1]);
                }
            }
            return defaultValue || false;
        }

        var submitButton = document.getElementById('submitButton');
        submitButton.addEventListener('click', function() {
            console.log('Submit');

            // Set the return URL depending on the runtime environment
            var return_to = getQueryParam('return_to', 'pebblejs://close#');
            document.location =
                return_to + encodeURIComponent(JSON.stringify(getConfigData()));
        });

        (function() {
            document.getElementById("showsec").checked =
                parseInt(getQueryParam("showsec", 0));
            document.getElementById("showday").checked =
                parseInt(getQueryParam("showday", 1));
            document.getElementById("outline").checked =
                parseInt(getQueryParam("outline", 1));
            document.getElementById("bgcol").value =
                colorToString(getQueryParam("bgcol", 0));
        })();
</script>
</html>
